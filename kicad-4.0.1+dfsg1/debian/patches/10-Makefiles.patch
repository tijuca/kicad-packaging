Index: kicad-4.0.1/doc/Makefile
===================================================================
--- /dev/null
+++ kicad-4.0.1/doc/Makefile
@@ -0,0 +1,22 @@
+DESTDIR =
+DATE    = $(shell date +%Y%m%d)
+CMAKE_OPTS = -DCMAKE_INSTALL_PREFIX=/usr
+
+all:
+	mkdir -p build
+	if [ -z "$$(ls build/buildlog*)" ]; then \
+	  cd build; \
+	  echo "Build begin: $$(date +%H:%M:%S)" > buildlog-$(DATE); \
+	  cmake $(CMAKE_OPTS) ../kicad-doc-master; make | tee --append buildlog-$(DATE) | grep -Ev '^make\[3\]' ; \
+	  echo "Build end: $$(date +%H:%M:%S)" >> buildlog-$(DATE); \
+	fi
+
+clean:
+
+clean_all:
+	rm -rf build
+
+install: all
+	cd build; export DESTDIR=$(DESTDIR); make install
+
+.PHONY: all clean install
Index: kicad-4.0.1/Makefile
===================================================================
--- /dev/null
+++ kicad-4.0.1/Makefile
@@ -0,0 +1,61 @@
+DESTDIR    =
+VERSION    = $(shell basename $$(pwd)| sed 's/kicad-//')
+DATE       = $(shell date +%Y%m%d)
+CPPFLAGS   = $(shell dpkg-buildflags --get CPPFLAGS)
+CXXFLAGS   = $(shell dpkg-buildflags --get CXXFLAGS) $(CPPFLAGS)
+CMAKE_OPTS = -DKICAD_SKIP_BOOST=ON -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_CXX_FLAGS="$(CXXFLAGS)" -DBUILD_GITHUB_PLUGIN=OFF -DKICAD_REPO_NAME=stable -DKICAD_BUILD_VERSION=$(VERSION) -DDEFAULT_INSTALL_PATH=/usr -DKICAD_SCRIPTING=ON -DKICAD_SCRIPTING_MODULES=ON -DKICAD_SCRIPTING_WXPYTHON=ON
+SUBDIRS = doc library
+LDFLAGS = $(shell dpkg-buildflags --get LDFLAGS)
+MULTI   = -j4
+
+all:
+	mkdir -p build
+	if [ -z "$$(ls build/buildlog*)" ]; then \
+	  cd build; \
+	  echo "Build begin: $$(date +%H:%M:%S)" > buildlog-$(DATE); \
+	  cmake $(CMAKE_OPTS) ../ | tee --append buildlog-$(DATE); \
+	  make $(MULTI) LDFLAGS=$(LDFLAGS) | tee --append buildlog-$(DATE); \
+	  echo "Build end: $$(date +%H:%M:%S)" >> buildlog-$(DATE); \
+	fi
+	# no parallel build for doc: some intermediary files must be
+	# built in order
+	make -C doc -j1   $@
+	# parallel build does not harm with libraries
+	make -C library $(MULTI)   $@
+
+clean:
+
+clean_all:
+	rm -rf build boost_root .downloads-by-cmake
+	for d in $(SUBDIRS); do make -C $$d $@; done
+
+fix_48x48_icons:
+	images=$$(find $(DESTDIR)/usr/share/icons/hicolor/48x48 -name "*.png"); \
+	for f in $${images}; do \
+	  size=$$(identify $$f| sed -n 's/.* PNG \(4[^ ]*\) .*/\1/ p'); \
+	  if [ "$${size}" != "48x48" ]; then \
+	    echo "Resize $$(basename $$f) : $${size} => 48x48"; \
+	    convert -resize '48x48!' $$f $$f.tmp && mv $$f.tmp $$f; \
+	  fi; \
+	done
+
+install: all
+	cd build; export DESTDIR=$(DESTDIR); make install
+	# fix a few details
+	mkdir -p $(DESTDIR)/usr/share/pixmaps
+	cp bitmaps_png/icons/icon_kicad.xpm $(DESTDIR)/usr/share/pixmaps
+	make fix_48x48_icons
+	# move shared libraries
+	mkdir -p $(DESTDIR)/usr/lib/kicad
+	mv $(DESTDIR)/usr/bin/_* $(DESTDIR)/usr/lib/kicad
+	# strip shared libraries
+	strip $(DESTDIR)/usr/lib/kicad/_*
+	# symlink shared libraries to /usr/bin
+	for f in $(DESTDIR)/usr/lib/kicad/_*; do \
+	  ln -s ../lib/kicad/$$(basename $$f) $(DESTDIR)/usr/bin; \
+	done
+	# make subdirectories
+	for d in $(SUBDIRS); do make -C $$d $@ DESTDIR=$(DESTDIR); done
+
+
+.PHONY: all clean clean_all install fix_48x48icons
Index: kicad-4.0.1/library/Makefile
===================================================================
--- /dev/null
+++ kicad-4.0.1/library/Makefile
@@ -0,0 +1,30 @@
+DESTDIR =
+DATE    = $(shell date +%Y%m%d)
+CMAKE_OPTS = -DKICAD_SKIP_BOOST=ON -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_CXX_FLAGS="$(shell dpkg-buildflags --get CXXFLAGS)"
+
+all:
+	mkdir -p build
+	if [ -z "$$(ls build/buildlog*)" ]; then \
+	  cd build; \
+	  echo "Build begin: $$(date +%H:%M:%S)" > buildlog-$(DATE); \
+	  cmake $(CMAKE_OPTS) ../kicad-library-master; make | tee --append buildlog-$(DATE) | grep -Ev '^make\[3\]' ; \
+	  echo "Build end: $$(date +%H:%M:%S)" >> buildlog-$(DATE); \
+	fi
+
+clean:
+
+clean_all:
+	rm -rf build
+
+install: all
+	cd build; export DESTDIR=$(DESTDIR); make install
+	# take .pretty files by default
+	cp $(DESTDIR)/usr/share/kicad/template/fp-lib-table.for-pretty $(DESTDIR)/usr/share/kicad/template/fp-lib-table
+	# install .pretty directories
+	for d in *.pretty-master; do \
+	  e=$$(echo $$d | sed 's/-master$$//'); \
+	  mkdir -p $(DESTDIR)/usr/share/kicad/modules/$$e; \
+	  cp -Rd $$d/* $(DESTDIR)/usr/share/kicad/modules/$$e; \
+	done
+
+.PHONY: all clean install
