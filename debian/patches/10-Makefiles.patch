Index: kicad-4.0.2+dfsg1/doc/Makefile
===================================================================
--- /dev/null
+++ kicad-4.0.2+dfsg1/doc/Makefile
@@ -0,0 +1,18 @@
+DESTDIR =
+DATE    = $(shell date +%Y%m%d)
+CMAKE_OPTS = -DCMAKE_INSTALL_PREFIX=/usr
+
+all:
+	mkdir -p build
+	cd build; cmake $(CMAKE_OPTS) ../kicad-doc-master; $(MAKE)
+
+clean:
+	rm -f *~
+
+distclean: clean
+	rm -rf build
+
+install: all
+	cd build; export DESTDIR=$(DESTDIR); $(MAKE) install
+
+.PHONY: all clean install
Index: kicad-4.0.2+dfsg1/Makefile
===================================================================
--- /dev/null
+++ kicad-4.0.2+dfsg1/Makefile
@@ -0,0 +1,81 @@
+DESTDIR    =
+VERSION    = $(shell basename $$(pwd)| sed 's/kicad-//')
+DATE       = $(shell date +%Y%m%d)
+CPPFLAGS   = $(shell dpkg-buildflags --get CPPFLAGS)
+CXXFLAGS   = $(shell dpkg-buildflags --get CXXFLAGS) $(CPPFLAGS)
+CMAKE_OPTS = -DKICAD_SKIP_BOOST=ON -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_CXX_FLAGS="$(CXXFLAGS)" -DBUILD_GITHUB_PLUGIN=OFF -DKICAD_REPO_NAME=stable -DKICAD_BUILD_VERSION=$(VERSION) -DDEFAULT_INSTALL_PATH=/usr -DKICAD_SCRIPTING=ON -DKICAD_SCRIPTING_MODULES=ON -DKICAD_SCRIPTING_WXPYTHON=ON
+SUBDIRS = doc library i18n
+LDFLAGS = $(shell dpkg-buildflags --get LDFLAGS)
+
+all:
+	mkdir -p build
+	cd build; cmake $(CMAKE_OPTS) ../; $(MAKE) LDFLAGS=$(LDFLAGS)
+	# no parallel build for doc: some intermediary files must be
+	# built in order
+	$(MAKE) -C doc -j1   $@
+	# parallel build does not harm with libraries
+	$(MAKE) -C library $(MULTI)   $@
+	# parallel build does not harm with i18n
+	$(MAKE) -C i18n $(MULTI)   $@
+
+clean:
+	rm -f *~
+
+distclean: clean
+	rm -rf build boost_root .downloads-by-cmake
+	for d in $(SUBDIRS); do $(MAKE) -C $$d $@; done
+	# take care of files not cleaned properly
+	rm -f common/fp_lib_table_keywords.cpp
+	rm -f common/gal/opengl/shader_src.h
+	rm -f common/netlist_keywords.cpp
+	rm -f common/page_layout/page_layout_reader_keywords.cpp
+	rm -f common/pcb_keywords.cpp
+	rm -f common/pcb_plot_params_keywords.cpp
+	rm -f eeschema/cmp_library_keywords.cpp
+	rm -f eeschema/cmp_library_lexer.h
+	rm -f eeschema/dialogs/dialog_bom_cfg_keywords.cpp
+	rm -f eeschema/dialogs/dialog_bom_cfg_lexer.h
+	rm -f eeschema/dialogs/dialog_bom_help_html.h
+	rm -f eeschema/template_fieldnames_keywords.cpp
+	rm -f eeschema/template_fieldnames_lexer.h
+	rm -f include/fp_lib_table_lexer.h
+	rm -f include/netlist_lexer.h
+	rm -f include/page_layout_reader_lexer.h
+	rm -f include/pcb_lexer.h
+	rm -f include/pcb_plot_params_lexer.h
+	rm -f pcb_calculator/pcb_calculator_datafile_keywords.cpp
+	rm -f pcb_calculator/pcb_calculator_datafile_lexer.h
+	rm -f pcbnew/dialogs/dialog_freeroute_exchange_help_html.h
+	rm -f pcbnew/specctra_keywords.cpp
+	rm -f pcbnew/specctra_lexer.h
+
+fix_48x48_icons:
+	images=$$(find $(DESTDIR)/usr/share/icons/hicolor/48x48 -name "*.png"); \
+	for f in $${images}; do \
+	  size=$$(identify $$f| sed -n 's/.* PNG \(4[^ ]*\) .*/\1/ p'); \
+	  if [ "$${size}" != "48x48" ]; then \
+	    echo "Resize $$(basename $$f) : $${size} => 48x48"; \
+	    convert -resize '48x48!' $$f $$f.tmp && mv $$f.tmp $$f; \
+	  fi; \
+	done
+
+install: all
+	cd build; export DESTDIR=$(DESTDIR); $(MAKE) install
+	# fix a few details
+	mkdir -p $(DESTDIR)/usr/share/pixmaps
+	cp bitmaps_png/icons/icon_kicad.xpm $(DESTDIR)/usr/share/pixmaps
+	$(MAKE) fix_48x48_icons
+	# move shared libraries
+	mkdir -p $(DESTDIR)/usr/lib/kicad
+	mv $(DESTDIR)/usr/bin/_* $(DESTDIR)/usr/lib/kicad
+	# strip shared libraries
+	strip $(DESTDIR)/usr/lib/kicad/_*
+	# symlink shared libraries to /usr/bin
+	for f in $(DESTDIR)/usr/lib/kicad/_*; do \
+	  ln -s ../lib/kicad/$$(basename $$f) $(DESTDIR)/usr/bin; \
+	done
+	# make subdirectories
+	for d in $(SUBDIRS); do $(MAKE) -C $$d $@ DESTDIR=$(DESTDIR); done
+
+
+.PHONY: all clean clean_all install fix_48x48icons
Index: kicad-4.0.2+dfsg1/library/Makefile
===================================================================
--- /dev/null
+++ kicad-4.0.2+dfsg1/library/Makefile
@@ -0,0 +1,26 @@
+DESTDIR =
+DATE    = $(shell date +%Y%m%d)
+CMAKE_OPTS = -DKICAD_SKIP_BOOST=ON -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_CXX_FLAGS="$(shell dpkg-buildflags --get CXXFLAGS)"
+
+all:
+	mkdir -p build
+	cd build; cmake $(CMAKE_OPTS) ../kicad-library-master; $(MAKE) 
+
+clean:
+	rm -f *~
+
+distclean: clean
+	rm -rf build
+
+install: all
+	cd build; export DESTDIR=$(DESTDIR); $(MAKE) install
+	# take .pretty files by default
+	cp $(DESTDIR)/usr/share/kicad/template/fp-lib-table.for-pretty $(DESTDIR)/usr/share/kicad/template/fp-lib-table
+	# install .pretty directories
+	for d in *.pretty-master; do \
+	  e=$$(echo $$d | sed 's/-master$$//'); \
+	  mkdir -p $(DESTDIR)/usr/share/kicad/modules/$$e; \
+	  cp -Rd $$d/* $(DESTDIR)/usr/share/kicad/modules/$$e; \
+	done
+
+.PHONY: all clean install
Index: kicad-4.0.2+dfsg1/i18n/Makefile
===================================================================
--- /dev/null
+++ kicad-4.0.2+dfsg1/i18n/Makefile
@@ -0,0 +1,18 @@
+DESTDIR =
+DATE    = $(shell date +%Y%m%d)
+CMAKE_OPTS = -DCMAKE_INSTALL_PREFIX=/usr -DKICAD_I18N_UNIX_STRICT_PATH=ON
+
+all:
+	mkdir -p build
+	cd build; cmake $(CMAKE_OPTS) ../kicad-i18n-master; $(MAKE)
+
+clean:
+	rm -f *~
+
+distclean: clean
+	rm -rf build
+
+install: all
+	cd build; export DESTDIR=$(DESTDIR); $(MAKE) install
+
+.PHONY: all clean install
